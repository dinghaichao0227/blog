<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scatter Plot with Canvas</title>
</head>

<body>
  <canvas id="scatterCanvas" width="400" height="400" style="background-color: aqua;"></canvas>

  <script>
    /* 获取 Canvas 元素和上下文 */
    var canvas = document.getElementById('scatterCanvas');
    var ctx = canvas.getContext('2d');

    /* 设置数据 */
    var data = [
      { x: 90, y: 145 },
      { x: 150, y: 180 },

      // 添加更多数据点...
    ];
    var scale = 1
    var scaleFactor = 0.2
    /* 设置绘图参数 */
    var pointRadius = 10; // 点的半径
    var canvasCenterX = canvas.width / 2;
    var canvasCenterY = canvas.height / 2;

    /* 绘制散点图 */
    function drawScatterPlot() {
      ctx.clearRect(0, 0, canvas.width, canvas.height); // 清空画布

      for (var i = 0; i < data.length; i++) {
        var point = data[i];

        ctx.beginPath();
        ctx.arc(point.x, point.y, pointRadius, 0, 2 * Math.PI); // 绘制圆形点
        ctx.fillStyle = 'blue'; // 设置点的填充颜色
        ctx.fill();
        ctx.closePath();
      }
    }

    canvas.addEventListener('wheel', function (e) {
      e.preventDefault();
      var wheelDelta = e.deltaY;
      var zoomFactorIncrement = 0.1;
      var zoomFactor = 1;
      var offsetX = e.offsetX;
      var offsetY = e.offsetY;


      // 保存当前的十字虚线宽度和样式
      var prevCrosshairWidth = crosshairWidth;
      var prevCrosshairDash = crosshairDash.slice();
      if (wheelDelta < 0) {
        zoomFactor += zoomFactorIncrement;
        var offerSetFromCenterX = offsetX - canvasCenterX;
        var offerSetFromCenterY = offsetY - canvasCenterY;
        var scaledOffSetX = canvasCenterX + offerSetFromCenterX * zoomFactor;
        var scaledOffSetY = canvasCenterY + offerSetFromCenterY * zoomFactor;
        drawScatterPlot();
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.translate(scaledOffSetX, scaledOffSetY);
        ctx.scale(zoomFactor, zoomFactor);
        ctx.translate(-scaledOffSetX, -scaledOffSetY);
      } else {
        zoomFactor -= zoomFactorIncrement;
        var offerSetFromCenterX = offsetX - canvasCenterX;
        var offerSetFromCenterY = offsetY - canvasCenterY;
        var scaledOffSetX = canvasCenterX + offerSetFromCenterX * zoomFactor;
        var scaledOffSetY = canvasCenterY + offerSetFromCenterY * zoomFactor;
        drawScatterPlot();
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.translate(scaledOffSetX, scaledOffSetY);
        ctx.scale(zoomFactor, zoomFactor);
        ctx.translate(-scaledOffSetX, -scaledOffSetY);
      }
      drawScatterPlot();

    })




    /* 调用绘制函数 */
    var crosshairColor = 'red'; // 十字虚线的颜色
    var crosshairWidth = 1; // 十字虚线的宽度
    var crosshairDash = [5, 5]; // 十字虚线的样式
    var showCoordinates = true; // 是否展示坐标
    var coordinatesColor = 'black'; // 坐标文本的颜色
    var coordinatesFont = '14px Arial'; // 坐标文本的字体

    /* 绘制十字虚线和展示坐标 */
    // function drawCrosshair(event) {
    //   var rect = canvas.getBoundingClientRect();
    //   var mouseX = event.clientX - rect.left;
    //   var mouseY = event.clientY - rect.top;

    //   // ctx.clearRect(0, 0, canvas.width, canvas.height); // 清空画布
    //   drawScatterPlot()
    //   // 绘制横线
    //   ctx.beginPath();
    //   ctx.setLineDash(crosshairDash);
    //   ctx.moveTo(0, mouseY);
    //   ctx.lineTo(canvas.width, mouseY);
    //   ctx.lineWidth = crosshairWidth;
    //   ctx.strokeStyle = crosshairColor;
    //   ctx.stroke();

    //   // 绘制竖线
    //   ctx.beginPath();
    //   ctx.setLineDash(crosshairDash);
    //   ctx.moveTo(mouseX, 0);
    //   ctx.lineTo(mouseX, canvas.height);
    //   ctx.lineWidth = crosshairWidth;
    //   ctx.strokeStyle = crosshairColor;
    //   ctx.stroke();

    //   // 展示坐标
    //   if (showCoordinates) {
    //     ctx.fillStyle = coordinatesColor;
    //     ctx.font = coordinatesFont;
    //     ctx.fillText(`(${mouseX},${mouseY})`, mouseX + 10, mouseY - 10);
    //   }
    // }
    var isDialog = false
    var dataItem = null // data 的每一行数据
    canvas.addEventListener('mousedown', function (e) {
      data.map(item => {
        if (
          (item.x - e.offsetX <= pointRadius * 2 && item.x - e.offsetX >= -pointRadius)
          &&
          (item.y - e.offsetY <= pointRadius * 2 && item.y - e.offsetY >= -pointRadius)
        ) {
          dataItem = item
          isDialog = true
        }
      })
    })

    /* 监听鼠标移动事件 */
    canvas.addEventListener('mousemove', function (e) {
      if (isDialog) {
        data.map(item => {
          if (item.x === dataItem.x && item.y === dataItem.y) {
            item.x = e.offsetX
            item.y = e.offsetY
          }
        })

      }

      // drawCrosshair(event)
    });


    canvas.addEventListener('mouseup', function (e) {
      isDialog = false
    })

    /* 监听鼠标离开事件，清空画布 */
    canvas.addEventListener('mouseout', function () {
      // ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawScatterPlot()
    });
    drawScatterPlot();

  </script>
</body>

</html>